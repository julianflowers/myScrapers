---
title: "Extracting information from PHE blogs and publications"
author: "Julian Flowers"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{phe blog extraction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  cache = TRUE,
  warning = FALSE
)

library(tidyverse, quietly = TRUE)

```

PHE publishes a range of information to <https://www.gov.uk/phe> inlcuding blogs, statistics and other publications.

This vignette introduces an internal PHE R package `myScrapers` which includes tools to extract published information from the .gov.uk site. The tools include:

* `blog_type_extractor` which pulls a dataframe of blog topics or authors
* `phe_blog_scraper` which allows the user to retrieve the text of blogs by topic into a tidy data frame.
* `phe_catalogue` which downloads an interactive table of PHE publications.

These tools are intended to help text mining and analysis of published content, and assist developing outputs such as products and services catalogues.

The functions are assembled as an R package which is currently available on github.


## Getting started

The first step is to install the package. This can be achieved with the code below:

```{r message=FALSE, warning=FALSE}
library(devtools)
install_github("julianflowers/myScrapers", build_vignettes =TRUE)
library(myScrapers)


```

## Blog topics

We can obtain a table of blog topic categories.

```{r, warning=FALSE}


 
ds <- blog_type_extractor(type = "category")

ds %>%
  select(topic = `.x[[i]]`) %>%
  arrange(topic)

```


## Blog authors

We can obtain a table of blog authors.

```{r, warning=FALSE}


 
ds <- blog_type_extractor(type = "author")

ds %>%
  select(author = `.x[[i]]`) %>%
  arrange(author) %>%
  slice(4:nrow(.)) 

```


## Blog text

We can extract blog posts for any given category e.g.

```{r}
cat <- "cko"

blog <- phe_blog_scraper(cat, n = 7)


blog

```

## Plots

We can then undertake simple analysis - for example plot category counts

```{r fig.height=6, fig.width=6}


blog %>%
  group_by(quarter = zoo::as.yearqtr(date)) %>%
  count() %>%
  ggplot(aes(quarter, n)) +
  geom_col() +
  labs(title = "CKO blogs - quarterly count") +
  govstyle::theme_gov()



```

## PHE publications

PHE is planning to create a products and services catalogue. To assist this process we have written a function which produces an interactive table of all the PHE publications by category (NB at the moment it is over inclusive). This makes use of the `DT` package and allows us to add download options so the data can be downloaded in various forms.

```{r}

phe_catalogue(url = "https://www.gov.uk/government/publications?departments%5B%5D=public-health-england", pages = 2:90)

```

